{% extends "layouts/app_base.html" %}
{% load static %}

{% block title %}Market - NepseSewa{% endblock %}

{% block extra_css %}
<style>
  /* Market Page Styles */
  .filter-box {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
  }

  .asof-pill {
    background: rgba(16, 185, 129, .10);
    color: var(--primary-dark);
    font-size: .75rem;
    font-weight: 800;
    padding: .25rem .75rem;
    border-radius: 999px;
    letter-spacing: .5px;
  }

  .table thead th {
    font-size: .75rem;
    text-transform: uppercase;
    color: var(--muted);
    letter-spacing: .8px;
    font-weight: 800;
    border-bottom: 2px solid var(--border);
    padding-bottom: .75rem;
  }

  .table tbody td {
    vertical-align: middle;
    font-size: .9rem;
    padding: .85rem .75rem;
    border-bottom: 1px solid rgba(0, 0, 0, .03);
  }

  .table tbody tr:last-child td {
    border-bottom: none;
  }

  .pager {
    display: flex;
    align-items: center;
    gap: .5rem;
  }

  .pager button {
    border: 1px solid var(--border);
    background: #fff;
    padding: .4rem .8rem;
    border-radius: 8px;
    font-size: .85rem;
    font-weight: 700;
    color: #374151;
    transition: all .15s;
  }

  .pager button:hover:not(:disabled) {
    background: var(--light);
  }

  .pager button:disabled {
    opacity: .5;
    cursor: not-allowed;
  }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-0" style="font-weight:900;">Market Overview</h4>
    <div class="text-muted" style="font-weight:700;">Live prices â€¢ All listed stocks</div>
  </div>
  <div class="asof-pill">
    <i class="fa-solid fa-circle me-1" style="font-size:6px;vertical-align:middle;"></i>
    LIVE MARKET
  </div>
</div>

<!-- Filter Bar -->
<div class="filter-box">
  <div class="flex-grow-1" style="max-width: 250px;">
    <div class="input-group">
      <span class="input-group-text bg-transparent border-end-0">
        <i class="fa-solid fa-calendar text-muted"></i>
      </span>
      <input id="marketDate" type="date" class="form-control border-start-0 ps-0" title="Select historical date">
    </div>
  </div>

  <div class="flex-grow-1" style="max-width: 300px;">
    <div class="input-group">
      <span class="input-group-text bg-transparent border-end-0">
        <i class="fa-solid fa-search text-muted"></i>
      </span>
      <input id="marketSearch" type="text" class="form-control border-start-0 ps-0"
        placeholder="Search symbol (e.g. NICA)...">
    </div>
  </div>

  <!-- Sector select -->
  <div style="width: 200px;">
    <select class="form-select" id="sectorSelect">
      <option value="">All Sectors</option>
      <!-- Populated dynamically via JS -->
      <option value="Commercial Banks">Commercial Banks</option>
      <option value="Development Banks">Development Banks</option>
      <option value="Finance">Finance</option>
      <option value="Microfinance">Microfinance</option>
      <option value="Hydropower">Hydropower</option>
      <option value="Hotels & Tourism">Hotels & Tourism</option>
      <option value="Investment">Investment</option>
      <option value="Life Insurance">Life Insurance</option>
      <option value="Manufacturing & Processing">Manufacturing & Processing</option>
      <option value="Non-Life Insurance">Non-Life Insurance</option>
      <option value="Corporate Debentures">Corporate Debentures</option>
      <option value="Trading">Trading</option>
      <option value="Mutual Fund">Mutual Fund</option>
      <option value="Others">Others</option>
    </select>
  </div>

  <div class="ms-auto text-muted fw-bold font-monospace" id="marketCount">Loading...</div>
</div>

<!-- Table -->
<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table mb-0 table-hover">
        <thead>
          <tr>
            <th class="ps-4">Symbol</th>
            <th>LTP</th>
            <th>Change</th>
            <th class="text-end">Open</th>
            <th class="text-end">High</th>
            <th class="text-end">Low</th>
            <th class="text-end pe-4">Volume</th>
          </tr>
        </thead>
        <tbody id="marketBody">
          <tr>
            <td colspan="7" class="text-center text-muted p-4">Loading data...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="card-footer d-flex justify-content-between align-items-center">
    <div class="text-muted" style="font-size:.85rem;font-weight:700;">
      Showing page of live data
    </div>
    <div class="pager">
      <button id="btnPrev" disabled><i class="fa-solid fa-chevron-left"></i></button>
      <span id="pageInfo" style="font-weight:800;font-size:.9rem;">Page 1</span>
      <button id="btnNext"><i class="fa-solid fa-chevron-right"></i></button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/market.js' %}?v={{ 1767533110 }}"></script>
{% endblock %}